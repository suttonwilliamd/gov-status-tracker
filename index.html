<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>.Gov Status Monitor</title>
    <style>
        :root {
            --primary: #1a73e8;
            --online: #34a853;
            --offline: #ea4335;
            --checking: #fbbc05;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 1px solid #dfe1e5;
            border-radius: 24px;
            font-size: 16px;
            margin-bottom: 20px;
            box-shadow: 0 1px 6px rgba(32,33,36,.28);
        }

        .domain-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .online { background: var(--online); }
        .offline { background: var(--offline); }
        .checking { background: var(--checking); }

        .domain-info {
            flex-grow: 1;
        }

        .domain-name {
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }

        .domain-meta {
            font-size: 0.875rem;
            color: #5f6368;
        }

        .last-checked {
            font-size: 0.75rem;
            color: #80868b;
            text-align: right;
            margin-top: 8px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #5f6368;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>.Gov Website Status Monitor</h1>
            <input type="text" class="search-box" id="search" placeholder="Search .gov websites...">
        </div>
        <div id="list"></div>
        <div id="loading" class="loading">Loading domain statuses...</div>
    </div>

<script>
// Use GitHub raw content directly
const DATA_SOURCE = 'https://raw.githubusercontent.com/cisagov/dotgov-data/main/current-federal.csv';
const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
const STATUS_CHECKER = 'https://http-status-checker.vercel.app/api/check?url=';

let allDomains = [];

async function fetchDomains() {
    try {
        const response = await fetch(`${CORS_PROXY}${encodeURIComponent(DATA_SOURCE)}`);
        const text = await response.text();
        return text.split('\n')
            .slice(1) // Skip header
            .map(row => {
                const [domain, agency, org] = row.split(',').map(f => f.trim().replace(/"/g, ''));
                return { domain, agency, org };
            })
            .filter(d => d.domain && d.domain.endsWith('.gov'));
    } catch (error) {
        console.error('Error fetching domains:', error);
        return [];
    }
}

async function checkDomainStatus(domain) {
    try {
        const response = await fetch(`${STATUS_CHECKER}${encodeURIComponent(domain.domain)}`);
        const data = await response.json();
        return data.status === 'online';
    } catch (error) {
        return false;
    }
}

function createDomainCard(domain) {
    const card = document.createElement('div');
    card.className = 'domain-card';
    card.innerHTML = `
        <div class="status-dot checking"></div>
        <div class="domain-info">
            <div class="domain-name">${domain.domain}</div>
            <div class="domain-meta">
                ${domain.agency ? `<span>${domain.agency}</span>` : ''}
                ${domain.org ? `<span> â€¢ ${domain.org}</span>` : ''}
            </div>
        </div>
    `;
    return card;
}

async function updateList(filter = '') {
    const list = document.getElementById('list');
    const loading = document.getElementById('loading');
    
    // Initial load
    if (allDomains.length === 0) {
        loading.style.display = 'block';
        allDomains = await fetchDomains();
        loading.style.display = 'none';
    }

    list.innerHTML = '';
    const filtered = allDomains.filter(d => 
        d.domain.toLowerCase().includes(filter.toLowerCase()) ||
        d.agency?.toLowerCase().includes(filter.toLowerCase()) ||
        d.org?.toLowerCase().includes(filter.toLowerCase())
    );

    if (filtered.length === 0) {
        list.innerHTML = '<div class="loading">No matching domains found</div>';
        return;
    }

    // Show first 50 results for performance
    filtered.slice(0, 50).forEach(async domain => {
        const card = createDomainCard(domain);
        list.appendChild(card);
        
        // Update status after initial render
        const statusDot = card.querySelector('.status-dot');
        try {
            const isOnline = await checkDomainStatus(domain);
            statusDot.classList.remove('checking');
            statusDot.classList.add(isOnline ? 'online' : 'offline');
        } catch (error) {
            statusDot.classList.remove('checking');
            statusDot.classList.add('offline');
        }
    });
}

// Search functionality
document.getElementById('search').addEventListener('input', (e) => {
    updateList(e.target.value);
});

// Initial load
updateList();
</script>
</body>
</html>
