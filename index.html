<!DOCTYPE html>
<html>
<head>
    <title>.Gov Status Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 15px; }
        .status { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
        .online { background: #4CAF50; }
        .offline { background: #f44336; }
        .domain { word-break: break-all; }
    </style>
</head>
<body>
    <h1>.Gov Status Monitor</h1>
    <input type="text" id="search" placeholder="Search domains..." style="width:100%; padding:8px; margin-bottom:15px;">
    <div id="loader">Loading...</div>
    <div id="list"></div>

    <script>
        // Updated working data source
        const GOV_LIST_URL = "https://raw.githubusercontent.com/GSA/data/gh-pages/current-federal.csv";
        
        // Use reliable CORS proxy
        const fetchWithProxy = url => fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);

        async function fetchDomains() {
            try {
                const response = await fetchWithProxy(GOV_LIST_URL);
                const text = await response.text();
                return text.split('\n')
                    .slice(1) // Skip header
                    .map(row => {
                        const [domain, agency, org] = row.split(',').map(f => f.trim());
                        return { domain, agency, org };
                    })
                    .filter(d => d.domain && d.domain.endsWith('.gov'));
            } catch (e) {
                console.error('Failed to fetch domains:', e);
                return [];
            }
        }

        async function checkStatus(domain) {
            try {
                // Check through a reliable third-party service
                const response = await fetch(`https://httpstatus.dev/${domain}?format=json`);
                const data = await response.json();
                return data.status >= 200 && data.status < 400;
            } catch (e) {
                return false;
            }
        }

        async function updateList() {
            const loader = document.getElementById('loader');
            const list = document.getElementById('list');
            const searchTerm = document.getElementById('search').value.toLowerCase();

            loader.textContent = "Loading domains...";
            const domains = await fetchDomains();
            
            loader.textContent = domains.length ? "Checking statuses..." : "Failed to load domains";
            list.innerHTML = '';

            // Limit to 100 domains for mobile performance
            const limitedDomains = domains.slice(0, 100);

            for(const { domain, agency, org } of limitedDomains) {
                if(searchTerm && !domain.toLowerCase().includes(searchTerm)) continue;

                const item = document.createElement('div');
                item.style.padding = '10px';
                item.style.borderBottom = '1px solid #eee';
                item.innerHTML = `
                    <div class="domain">${domain}</div>
                    <small>${agency || ''} â€¢ ${org || ''}</small>
                    <div class="status"></div>
                `;
                
                list.appendChild(item);

                // Check status with timeout
                setTimeout(async () => {
                    try {
                        const online = await Promise.race([
                            checkStatus(domain),
                            new Promise(resolve => setTimeout(() => resolve(false), 5000))
                        ]);
                        item.querySelector('.status').className = `status ${online ? 'online' : 'offline'}`;
                    } catch (e) {
                        item.querySelector('.status').className = 'status offline';
                    }
                }, 0);
            }

            loader.textContent = domains.length ? "" : "No domains found";
        }

        // Initial load
        updateList();
        
        // Refresh every 2 minutes
        setInterval(updateList, 120000);
        
        // Search input
        document.getElementById('search').addEventListener('input', updateList);
    </script>
</body>
</html>
